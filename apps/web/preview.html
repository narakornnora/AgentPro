<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Preview</title>
  <style>
    html, body { height: 100%; margin:0; background:#0b0f14; color:#e8eef6; font-family: system-ui, -apple-system, Segoe UI, Roboto, Cantarell, 'Noto Sans Thai', sans-serif; }
    .bar {
      display:flex; align-items:center; gap:10px; padding:10px 14px;
      background:#10161d; border-bottom:1px solid #1f2a36; position:sticky; top:0; z-index:10;
    }
    .bar b { font-size:14px; opacity:.9 }
    .spacer { flex:1 }
    .btn {
      appearance:none; border:1px solid #2a3a4a; background:#16202a; color:#e8eef6;
      padding:8px 12px; border-radius:8px; cursor:pointer; font-size:14px;
    }
    .btn:hover { background:#1b2733 }
    .wrap { height:calc(100% - 52px); }
    .wrap, iframe { width:100%; height:100%; display:block; border:0; }
  </style>
</head>
<body>
  <div class="bar">
    <b id="title">Preview</b>
    <div class="spacer"></div>
    <button class="btn" id="btnOpen">เปิดแท็บใหม่</button>
    <button class="btn" id="btnFull">เต็มจอ (F)</button>
  </div>
  <div class="wrap">
    <iframe id="frame" src="about:blank" allowfullscreen></iframe>
  </div>

  <script>
    // อ่าน slug จาก query: ?slug=myapp-YYYYMMDD-HHmmss
    const q = new URLSearchParams(location.search);
    const slug = q.get('slug') || '';
    const url  = slug ? `/app/${slug}/index.html` : '/app/index.html';

    const frame = document.getElementById('frame');
    const title = document.getElementById('title');
    frame.src = url;
    title.textContent = `Preview: ${slug || 'latest'}`;

    // ปุ่ม เปิดแท็บใหม่
    document.getElementById('btnOpen').addEventListener('click', () => {
      window.open(url, '_blank');
    });

    // ปุ่ม เต็มจอ + ช็อตคัต F
    function goFull(el){
      const rfs = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
      if (rfs) rfs.call(el);
      else window.open(url, '_blank');
    }
    document.getElementById('btnFull').addEventListener('click', () => {
      // ขอเต็มจอที่ iframe หรือ container ก็ได้
      goFull(frame);
    });

    // กด F เพื่อเต็มจอ, ESC ออกเองตามระบบ
    window.addEventListener('keydown', (e)=>{
      if (e.key.toLowerCase() === 'f') { e.preventDefault(); goFull(frame); }
    });
  </script>
</body>
</html>
