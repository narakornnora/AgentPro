<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AgentPro ¬∑ Builder</title>
  <link rel="stylesheet" href="/tokens.css">
  <style>
    body{background:#0f1220;color:#e9eef5;font:14px/1.6 system-ui;margin:0}
    .wrap{max-width:880px;margin:24px auto;padding:0 16px}
    .box{background:#151925;border:1px solid #23283b;border-radius:12px;padding:16px}
    .input{width:100%;background:#10131b;border:1px solid #27304a;border-radius:8px;color:#e9eef5;padding:.6rem}
    .btn{background:#2f80ed;border:0;border-radius:8px;color:#fff;padding:.6rem .9rem;cursor:pointer}
    pre{background:#0e121b;padding:12px;border-radius:8px;overflow:auto}
    .row{display:flex;gap:8px;align-items:center}
    .small{color:#b9c2d0}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>AgentPro ¬∑ Builder</h2>
    <div class="box">
      <div class="small">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‚Äú‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü ‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‚Äù</div>
      <textarea id="prompt" class="input" rows="4" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå requirement ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
      <div class="row" style="margin-top:10px">
        <button class="btn" onclick="build()">üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö</button>
        <button class="btn" onclick="openLast()" title="‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î">üîó ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
      </div>
    </div>
    <div class="box" style="margin-top:12px">
      <h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
      <div class="small">‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</div>
      <pre id="out">(‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)</pre>
      <div id="open" style="margin-top:8px"></div>
    </div>
  </div>

  <script>
    const API = 'http://localhost:8001';
    let lastUrl = null;

    async function build(){
      const prompt = document.getElementById('prompt').value.trim();
      if(!prompt) return alert('‡∏û‡∏¥‡∏°‡∏û‡πå requirement ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
      setOut('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...');

      try{
        const res = await fetch(API + '/chat', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: prompt, session_id: 'builder' })
        });
        const data = await res.json();
        setOut(JSON.stringify(data, null, 2));
        
        if(data.action === 'build_app'){
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏õ‡∏à‡∏£‡∏¥‡∏á‡πÜ
          await buildApp(data.requirements);
        }else{
          setOut('AI Response: ' + data.response);
        }
      }catch(e){
        setOut('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e);
        document.getElementById('open').innerHTML = '';
      }
    }

    async function buildApp(requirements){
      setOut('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏≠‡∏õ...');
      
      try{
        const res = await fetch(API + '/build_app', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify(requirements)
        });
        const data = await res.json();
        
        if(data.app_url){
          lastUrl = data.app_url;
          setOut('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!');
          document.getElementById('open').innerHTML =
            `<a class="btn" href="${data.app_url}" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á ‚Üí</a>`;
        }else{
          setOut('‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (data.error || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'));
        }
      }catch(e){
        setOut('‚ùå Error: ' + e);
      }
    }

    function openLast(){
      if(!lastUrl) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
      window.open(lastUrl, '_blank');
    }

    function setOut(t){ document.getElementById('out').textContent = t; }
  </script>
</body>
</html>
